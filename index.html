<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Urbex Map</title>

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- JSZip for KMZ support -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <!-- Leaflet & Clusters -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />

    <link rel="stylesheet" href="style.css">

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
</head>

<body>

    <!-- LOGIN SCREEN -->
    <div id="login-screen">
        <div class="login-container">
            <div class="login-header">
                <i class="fa-solid fa-layer-group fa-2x"></i>
                <h1>Urbex Map</h1>
                <span class="subtitle">RESTRICTED ACCESS</span>
            </div>

            <form id="login-form">
                <div class="input-group">
                    <i class="fa-solid fa-envelope"></i>
                    <input type="email" id="email" placeholder="IDENTIFIANT (Email)" required>
                </div>
                <div class="input-group">
                    <i class="fa-solid fa-lock"></i>
                    <input type="password" id="password" placeholder="CLÉ DE SÉCURITÉ" required>
                </div>
                <button type="submit" id="btn-login">
                    AUTHENTIFIER <i class="fa-solid fa-arrow-right"></i>
                </button>
            </form>
            <p id="status-message"></p>
            <div class="login-footer">
                CONNEXION SÉCURISÉE // CHIFFRÉE
            </div>
        </div>
    </div>

    <!-- APP WRAPPER -->
    <div id="app-screen">

        <!-- SIDEBAR -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fa-solid fa-layer-group"></i> Urbex Map
                </div>
                <div class="user-status">
                    <span class="dot"></span> <span id="user-display-name">EN LIGNE</span>
                </div>
            </div>

            <div class="search-box">
                <i class="fa-solid fa-search"></i>
                <input type="text" id="search-input" placeholder="Rechercher...">
            </div>

            <!-- CUSTOM CHECKBOX FILTER -->
            <div class="search-box" style="border-top: none; padding: 0;">
                <div class="custom-dropdown" id="country-dropdown">
                    <div class="dropdown-header" id="country-dropdown-btn">
                        <span><i class="fa-solid fa-globe"></i> Filtrer par pays...</span>
                        <i class="fa-solid fa-chevron-down"></i>
                    </div>
                    <div class="dropdown-content" id="country-list">
                        <!-- Populated by JS: Checkboxes -->
                    </div>
                </div>
            </div>
            <!-- Active Filter Tags -->
            <div id="active-filters" class="filter-tags-container"></div>


            <div class="tools-panel">
                <button id="btn-trigger-import" class="tool-btn" title="Importer KML/KMZ">
                    <i class="fa-solid fa-file-import"></i> Importer
                </button>
                <input type="file" id="kml-input" accept=".kml,.kmz" style="display:none;">

                <!-- ADMIN BUTTON -->
                <button id="btn-open-admin" class="tool-btn" style="display:none;" title="Panneau Admin">
                    <i class="fa-solid fa-user-shield"></i> Admin
                </button>

                <button id="btn-logout" class="tool-btn danger" title="Se déconnecter">
                    <i class="fa-solid fa-power-off"></i>
                </button>
            </div>

            <div class="list-header">
                <span>BASE DE DONNÉES</span>
                <span id="locations-count">0</span>
            </div>

            <div id="locations-list" class="locations-list">
                <!-- Javascript will populate this -->
                <div class="empty-state">Aucun signal détecté</div>
            </div>
        </aside>

        <!-- MAP CONTAINER -->
        <main class="map-container">
            <!-- Sidebar Toggle Button -->
            <button id="btn-toggle-sidebar" title="Masquer/Afficher le menu">
                <i class="fa-solid fa-chevron-left"></i>
            </button>

            <div id="map"></div>
            <!-- Overlay Info (Optional) -->
            <div class="map-overlay-info">
                LAT: <span id="cursor-lat">0.0000</span> | LNG: <span id="cursor-lng">0.0000</span>
            </div>
        </main>

    </div>

    <!-- CUSTOM MODAL -->
    <div id="custom-modal" class="modal-overlay">
        <div class="modal-box">
            <h3 id="modal-title">Attention</h3>
            <p id="modal-message">Message...</p>
            <div class="modal-actions">
                <button id="modal-btn-cancel" class="tool-btn danger">Annuler</button>
                <button id="modal-btn-confirm" class="tool-btn">Confirmer</button>
            </div>
        </div>
    </div>

    <!-- EDIT LOCATION MODAL -->
    <div id="edit-modal" class="modal-overlay">
        <div class="modal-box edit-box">
            <h3>Modifier le lieu</h3>
            <input type="hidden" id="edit-id">

            <label>Nom</label>
            <input type="text" id="edit-name" placeholder="Nom du lieu">

            <label>Description</label>
            <textarea id="edit-desc" rows="3" placeholder="Description..."></textarea>

            <label>Photos (URL)</label>
            <div class="photo-input-row">
                <input type="text" id="edit-photo-url" placeholder="https://...">
                <button id="btn-add-photo" class="tool-btn"><i class="fa-solid fa-plus"></i></button>
            </div>
            <div id="edit-photos-list" class="photos-list"></div>

            <div class="modal-actions">
                <button id="btn-cancel-edit" class="tool-btn danger">Annuler</button>
                <button id="btn-save-edit" class="tool-btn">Enregistrer</button>
            </div>
        </div>
    </div>

    <!-- ADMIN MODAL -->
    <div id="admin-modal" class="modal-overlay">
        <div class="modal-box">
            <h2><i class="fa-solid fa-user-shield"></i> Panneau Administrateur</h2>

            <div
                style="margin-bottom: 20px; padding: 15px; background: rgba(75,0,130,0.1); border-radius: 6px; border:1px solid rgba(75,0,130,0.3);">
                <h3 style="font-size:14px; margin-bottom:15px; color:#fff;">Créer un nouvel utilisateur</h3>

                <div class="input-group" style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px; font-size:12px; color:#aaa;">Pseudo</label>
                    <input type="text" id="new-user-pseudo" placeholder="Pseudo"
                        style="width:100%; padding:8px; background:#0a0a0a; border:1px solid #333; color:#fff;">
                </div>

                <div class="input-group" style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px; font-size:12px; color:#aaa;">Email</label>
                    <input type="email" id="new-user-email" placeholder="email@exemple.com"
                        style="width:100%; padding:8px; background:#0a0a0a; border:1px solid #333; color:#fff;">
                </div>

                <div class="input-group" style="margin-bottom:15px;">
                    <label style="display:block; margin-bottom:5px; font-size:12px; color:#aaa;">Mot de passe</label>
                    <input type="password" id="new-user-pass" placeholder="********"
                        style="width:100%; padding:8px; background:#0a0a0a; border:1px solid #333; color:#fff;">
                </div>

                <!-- Permissions -->
                <div style="margin-bottom: 20px; display:flex; gap:15px;">
                    <label style="display:flex; align-items:center; gap:8px; font-size:12px; cursor:pointer;">
                        <input type="checkbox" id="check-is-admin">
                        Admin
                    </label>
                    <label style="display:flex; align-items:center; gap:8px; font-size:12px; cursor:pointer;">
                        <input type="checkbox" id="check-can-add">
                        Peut ajouter des points
                    </label>
                </div>

                <button id="btn-create-user" class="tool-btn" style="width:100%; justify-content:center;">
                    <i class="fa-solid fa-user-plus"></i> Créer le compte
                </button>
            </div>

            <div class="modal-actions">
                <button id="btn-close-admin" class="tool-btn danger">Fermer</button>
            </div>
        </div>
    </div>

    <!-- LIGHTBOX MODAL -->
    <div id="lightbox-modal" class="modal-overlay" style="z-index: 4000; background: rgba(0,0,0,0.95);">
        <button id="btn-close-lightbox"
            style="position:absolute; top:20px; right:20px; background:none; border:none; color:#fff; font-size:30px; cursor:pointer;">&times;</button>
        <img id="lightbox-img" src=""
            style="max-width:90%; max-height:90%; border-radius:4px; box-shadow:0 0 50px rgba(0,0,0,0.5);">
    </div>

    <script type="module" src="app.js?v=54"></script>
</body>

</html>